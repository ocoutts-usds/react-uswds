import{a as P,j as d}from"./jsx-runtime-2xDJh5tt.js";import{r as p}from"./index-CBqU2yxZ.js";import{c as H}from"./index-Bl6ORisp.js";const Y=(o,r="",O={})=>{const m=y=>y.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");let I=o.replace(/{{(.*?)}}/g,(y,n)=>{const c=n.trim(),l=O[c];if(c!=="query"&&l){const b=new RegExp(l,"i"),u=r.match(b);return u?m(u[1]):""}return m(r)});return I="^(?:"+I+")$",new RegExp(I,"i")};var s=(o=>(o[o.SELECT_OPTION=0]="SELECT_OPTION",o[o.CLEAR=1]="CLEAR",o[o.OPEN_LIST=2]="OPEN_LIST",o[o.CLOSE_LIST=3]="CLOSE_LIST",o[o.FOCUS_OPTION=4]="FOCUS_OPTION",o[o.UPDATE_FILTER=5]="UPDATE_FILTER",o[o.BLUR=6]="BLUR",o[o.CLEAR_SELECTION=7]="CLEAR_SELECTION",o[o.FOCUS_INPUT=8]="FOCUS_INPUT",o))(s||{});const Z=(o,r,O,m)=>{const I=n=>{const c=Y(m.filter,n,m.extras),l=r.filter(b=>c.test(b.label.toLowerCase()));return O?{closestMatch:l.length>0?l[0]:r[0],optionsToDisplay:r}:{closestMatch:l[0],optionsToDisplay:l}},y=(n,c)=>{switch(c.type){case 0:return{...n,isOpen:!1,selectedOption:c.option,focusMode:_.Input,inputValue:c.option.label,filteredOptions:r,focusedOption:c.option,statusText:""};case 5:{const{closestMatch:l,optionsToDisplay:b}=I(c.value),u={...n,isOpen:!0,filteredOptions:b,inputValue:c.value,statusText:`${b.length} result${b.length>1?"s":""} available.`};return b.length<1&&(u.statusText="No results."),O||!n.selectedOption?u.focusedOption=l:n.selectedOption&&(u.filteredOptions.includes(n.selectedOption)?u.focusedOption=n.selectedOption:u.focusedOption=l),u}case 2:{const l=n.filteredOptions.length?`${n.filteredOptions.length} result${n.filteredOptions.length>1?"s":""} available.`:"No results.";return{...n,isOpen:!0,focusMode:_.Input,focusedOption:n.selectedOption||n.focusedOption||r[0],statusText:l}}case 3:{const l={...n,isOpen:!1,focusMode:_.Input,focusedOption:void 0,statusText:""};return n.filteredOptions.length===0&&(l.filteredOptions=r,l.inputValue=""),n.selectedOption&&(l.inputValue=n.selectedOption.label),l}case 4:{const l=n.filteredOptions.length?`${n.filteredOptions.length} result${n.filteredOptions.length>1?"s":""} available.`:"No results.";return{...n,isOpen:!0,focusedOption:c.option,focusMode:_.Item,statusText:l}}case 1:return{...n,inputValue:"",isOpen:!1,focusMode:_.Input,selectedOption:void 0,filteredOptions:r,focusedOption:r[0],statusText:""};case 6:{const l={...n,isOpen:!1,focusMode:_.None,filteredOptions:r,statusText:""};return n.selectedOption?(l.inputValue=n.selectedOption.label,l.focusedOption=n.selectedOption):(l.inputValue="",l.focusedOption=r[0]),l}case 7:return{...n,inputValue:"",isOpen:!1,focusMode:_.None,selectedOption:void 0,filteredOptions:r,focusedOption:void 0,statusText:""};case 8:return{...n,focusMode:_.Input};default:throw new Error}};return p.useReducer(y,o)},ee=".*{{query}}.*";var _=(o=>(o[o.None=0]="None",o[o.Input=1]="Input",o[o.Item=2]="Item",o))(_||{});const te=({focused:o,...r})=>{const O=p.useRef(null);return p.useEffect(()=>{o&&O.current&&O.current.focus()}),d("input",{type:"text",...r,className:"usa-combo-box__input","data-testid":"combo-box-input",autoCapitalize:"off",autoComplete:"off",ref:O})},oe=({id:o,name:r,className:O,options:m,defaultValue:I,disabled:y,onChange:n,assistiveHint:c,noResults:l,selectProps:b,inputProps:u,ulProps:k,customFilter:w,disableFiltering:v=!1},q)=>{var V;const g=!!y;let h;I&&(h=m.find(e=>e.value===I));const F=w||{filter:ee},$={isOpen:!1,selectedOption:h||void 0,focusedOption:void 0,focusMode:0,filteredOptions:m,inputValue:h?h.label:"",statusText:""},[t,a]=Z($,m,v,F),L=p.useRef(null),T=p.useRef(null),x=p.useRef(null);p.useEffect(()=>{var e;n&&n(((e=t.selectedOption)==null?void 0:e.value)||void 0)},[t.selectedOption]),p.useEffect(()=>{t.focusMode===2&&t.focusedOption&&x.current&&x.current.focus()},[t.focusMode,t.focusedOption]),p.useEffect(()=>{if(t.isOpen&&t.focusedOption&&x.current&&T.current&&t.focusMode===1){const e=x.current.offsetTop+x.current.offsetHeight,i=T.current.scrollTop+T.current.offsetHeight;e>i&&(T.current.scrollTop=e-T.current.offsetHeight),x.current.offsetTop<T.current.scrollTop&&(T.current.scrollTop=x.current.offsetTop)}},[t.isOpen,t.focusedOption]),p.useEffect(()=>{var e;t.focusMode!==0&&((e=L.current)!=null&&e.contains(window.document.activeElement)||a({type:s.BLUR}))},[t.focusMode]),p.useImperativeHandle(q,()=>({focus:()=>a({type:s.FOCUS_INPUT}),clearSelection:()=>a({type:s.CLEAR_SELECTION})}),[]);const K=e=>{if(e.key==="Escape")a({type:s.CLOSE_LIST});else if(e.key==="ArrowDown"||e.key=="Down")e.preventDefault(),a({type:s.FOCUS_OPTION,option:t.selectedOption||t.focusedOption||t.filteredOptions[0]});else if(e.key==="Tab"){if(t.isOpen&&!t.selectedOption){const i=v?t.focusedOption:t.selectedOption||t.focusedOption;i?(e.preventDefault(),a({type:s.FOCUS_OPTION,option:i})):a({type:s.BLUR})}!t.isOpen&&t.selectedOption&&a({type:s.BLUR})}else if(e.key==="Enter"&&t.isOpen){e.preventDefault();const i=t.filteredOptions.find(f=>f.label.toLowerCase()===t.inputValue.toLowerCase());i?a({type:s.SELECT_OPTION,option:i}):t.selectedOption?a({type:s.CLOSE_LIST}):a({type:s.CLEAR})}},j=e=>{var E;const{relatedTarget:i}=e;(!i||i instanceof Node&&!((E=L.current)!=null&&E.contains(i)))&&t.focusMode!==0&&a({type:s.BLUR})},z=e=>{e.key==="Tab"&&t.isOpen&&t.selectedOption&&(e.preventDefault(),a({type:s.FOCUS_OPTION,option:t.selectedOption}))},R=(e,i,f)=>{const E=i.focusedOption?i.filteredOptions.indexOf(i.focusedOption):-1,N=i.filteredOptions[0],Q=i.filteredOptions[i.filteredOptions.length-1];if(E===-1)e({type:s.FOCUS_OPTION,option:N});else{const S=E+f;if(S<0)e({type:s.CLOSE_LIST});else if(S>=i.filteredOptions.length)e({type:s.FOCUS_OPTION,option:Q});else{const X=i.filteredOptions[S];e({type:s.FOCUS_OPTION,option:X})}}},W=e=>{var f;const{relatedTarget:i}=e;(!i||i instanceof Node&&!((f=L.current)!=null&&f.contains(i)))&&a({type:s.BLUR})},A=e=>{e.key==="Escape"?a({type:s.CLOSE_LIST}):e.key==="Tab"||e.key==="Enter"?(e.preventDefault(),t.focusedOption&&a({type:s.SELECT_OPTION,option:t.focusedOption})):e.key==="ArrowDown"||e.key==="Down"?(e.preventDefault(),R(a,t,1)):(e.key==="ArrowUp"||e.key==="Up")&&(e.preventDefault(),R(a,t,-1))},D=t.selectedOption&&t.selectedOption.label===t.inputValue,G=H("usa-combo-box",O,{"usa-combo-box--pristine":D}),C=`${o}--list`,U=`${o}--assistiveHint`,M=t.focusedOption?t.filteredOptions.findIndex(e=>e===t.focusedOption):-1,J=M>-1&&`${C}--option-${M}`;return P("div",{"data-testid":"combo-box","data-enhanced":"true",className:G,ref:L,children:[d("select",{...b,className:"usa-select usa-sr-only usa-combo-box__select",name:r,"aria-hidden":!0,tabIndex:-1,defaultValue:(V=t.selectedOption)==null?void 0:V.value,"data-testid":"combo-box-select",children:m.map(e=>d("option",{value:e.value,children:e.label},e.value))}),d(te,{...u,role:"combobox",onChange:e=>{u!=null&&u.onChange&&(u==null||u.onChange(e)),a({type:s.UPDATE_FILTER,value:e.target.value})},onClick:()=>a({type:s.OPEN_LIST}),onBlur:j,onKeyDown:K,value:t.inputValue,focused:t.focusMode===1,"aria-owns":C,"aria-controls":C,"aria-autocomplete":"list","aria-describedby":U,"aria-expanded":t.isOpen,"aria-activedescendant":t.isOpen&&J||"",id:o,disabled:g}),d("span",{className:"usa-combo-box__clear-input__wrapper",tabIndex:-1,children:d("button",{type:"button",className:"usa-combo-box__clear-input","aria-label":"Clear the select contents",onClick:()=>a({type:s.CLEAR}),"data-testid":"combo-box-clear-button",onKeyDown:z,hidden:!D||g,disabled:g,children:" "})}),d("span",{className:"usa-combo-box__input-button-separator",children:" "}),d("span",{className:"usa-combo-box__toggle-list__wrapper",tabIndex:-1,children:d("button",{"data-testid":"combo-box-toggle",type:"button",className:"usa-combo-box__toggle-list",tabIndex:-1,"aria-label":"Toggle the dropdown list",onClick:()=>a({type:t.isOpen?s.CLOSE_LIST:s.OPEN_LIST}),disabled:g,children:" "})}),P("ul",{...k,"data-testid":"combo-box-option-list",tabIndex:-1,id:C,className:"usa-combo-box__list",role:"listbox",ref:T,hidden:!t.isOpen,children:[t.filteredOptions.map((e,i)=>{const f=e===t.focusedOption,E=e===t.selectedOption,N=H("usa-combo-box__list-option",{"usa-combo-box__list-option--focused":f,"usa-combo-box__list-option--selected":E});return d("li",{ref:f?x:null,value:e.value,className:N,tabIndex:f?0:-1,role:"option","aria-selected":E,"aria-setsize":t.filteredOptions.length,"aria-posinset":i+1,id:C+`--option-${i}`,onKeyDown:A,onBlur:W,"data-testid":`combo-box-option-${e.value}`,"data-value":e.value,onMouseEnter:()=>a({type:s.FOCUS_OPTION,option:e}),onClick:()=>{a({type:s.SELECT_OPTION,option:e})},children:e.label},e.value)}),t.filteredOptions.length===0?d("li",{className:"usa-combo-box__list-option--no-results",children:l||"No results found"}):null]}),d("div",{className:"usa-combo-box__status usa-sr-only",role:"status",children:t.statusText}),d("span",{id:U,className:"usa-sr-only","data-testid":"combo-box-assistive-hint",children:c||`When autocomplete results are available use up and down arrows to review
           and enter to select. Touch device users, explore by touch or with swipe
           gestures.`})]})},B=p.forwardRef(oe);try{B.displayName="ComboBox",B.__docgenInfo={description:"",displayName:"ComboBox",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"ComboBoxOption[]"}},defaultValue:{defaultValue:null,description:"",name:"defaultValue",required:!1,type:{name:"string"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(val?: string | undefined) => void"}},assistiveHint:{defaultValue:null,description:"",name:"assistiveHint",required:!1,type:{name:"string"}},noResults:{defaultValue:null,description:"",name:"noResults",required:!1,type:{name:"string"}},inputProps:{defaultValue:null,description:"",name:"inputProps",required:!1,type:{name:"DetailedHTMLProps<InputHTMLAttributes<HTMLInputElement>, HTMLInputElement>"}},selectProps:{defaultValue:null,description:"",name:"selectProps",required:!1,type:{name:"DetailedHTMLProps<SelectHTMLAttributes<HTMLSelectElement>, HTMLSelectElement>"}},ulProps:{defaultValue:null,description:"",name:"ulProps",required:!1,type:{name:"DetailedHTMLProps<HTMLAttributes<HTMLUListElement>, HTMLUListElement>"}},customFilter:{defaultValue:null,description:"",name:"customFilter",required:!1,type:{name:"CustomizableFilter"}},disableFiltering:{defaultValue:{value:"false"},description:"",name:"disableFiltering",required:!1,type:{name:"boolean"}}}}}catch{}export{B as C};
