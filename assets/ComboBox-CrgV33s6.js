import{j as u}from"./jsx-runtime-CKrituN3.js";import{r as f}from"./index-CBqU2yxZ.js";import{c as B}from"./index-Bl6ORisp.js";const X=(o,a="",b={})=>{const p=h=>h.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");let I=o.replace(/{{(.*?)}}/g,(h,s)=>{const d=s.trim(),l=b[d];if(d!=="query"&&l){const m=new RegExp(l,"i"),c=a.match(m);return c?p(c[1]):""}return p(a)});return I="^(?:"+I+")$",new RegExp(I,"i")};var n=(o=>(o[o.SELECT_OPTION=0]="SELECT_OPTION",o[o.CLEAR=1]="CLEAR",o[o.OPEN_LIST=2]="OPEN_LIST",o[o.CLOSE_LIST=3]="CLOSE_LIST",o[o.FOCUS_OPTION=4]="FOCUS_OPTION",o[o.UPDATE_FILTER=5]="UPDATE_FILTER",o[o.BLUR=6]="BLUR",o[o.CLEAR_SELECTION=7]="CLEAR_SELECTION",o[o.FOCUS_INPUT=8]="FOCUS_INPUT",o))(n||{});const Y=(o,a,b,p)=>{const I=s=>{const d=X(p.filter,s,p.extras),l=a.filter(m=>d.test(m.label.toLowerCase()));return b?{closestMatch:l.length>0?l[0]:a[0],optionsToDisplay:a}:{closestMatch:l[0],optionsToDisplay:l}},h=(s,d)=>{switch(d.type){case 0:return{...s,isOpen:!1,selectedOption:d.option,focusMode:x.Input,inputValue:d.option.label,filteredOptions:a,focusedOption:d.option,statusText:""};case 5:{const{closestMatch:l,optionsToDisplay:m}=I(d.value),c={...s,isOpen:!0,filteredOptions:m,inputValue:d.value,statusText:`${m.length} result${m.length>1?"s":""} available.`};return m.length<1&&(c.statusText="No results."),b||!s.selectedOption?c.focusedOption=l:s.selectedOption&&(c.filteredOptions.includes(s.selectedOption)?c.focusedOption=s.selectedOption:c.focusedOption=l),c}case 2:{const l=s.filteredOptions.length?`${s.filteredOptions.length} result${s.filteredOptions.length>1?"s":""} available.`:"No results.";return{...s,isOpen:!0,focusMode:x.Input,focusedOption:s.selectedOption||s.focusedOption||a[0],statusText:l}}case 3:{const l={...s,isOpen:!1,focusMode:x.Input,focusedOption:void 0,statusText:""};return s.filteredOptions.length===0&&(l.filteredOptions=a,l.inputValue=""),s.selectedOption&&(l.inputValue=s.selectedOption.label),l}case 4:{const l=s.filteredOptions.length?`${s.filteredOptions.length} result${s.filteredOptions.length>1?"s":""} available.`:"No results.";return{...s,isOpen:!0,focusedOption:d.option,focusMode:x.Item,statusText:l}}case 1:return{...s,inputValue:"",isOpen:!1,focusMode:x.Input,selectedOption:void 0,filteredOptions:a,focusedOption:a[0],statusText:""};case 6:{const l={...s,isOpen:!1,focusMode:x.None,filteredOptions:a,statusText:""};return s.selectedOption?(l.inputValue=s.selectedOption.label,l.focusedOption=s.selectedOption):(l.inputValue="",l.focusedOption=a[0]),l}case 7:return{...s,inputValue:"",isOpen:!1,focusMode:x.None,selectedOption:void 0,filteredOptions:a,focusedOption:void 0,statusText:""};case 8:return{...s,focusMode:x.Input};default:throw new Error}};return f.useReducer(h,o)},Z=".*{{query}}.*";var x=(o=>(o[o.None=0]="None",o[o.Input=1]="Input",o[o.Item=2]="Item",o))(x||{});const A=({focused:o,...a})=>{const b=f.useRef(null);return f.useEffect(()=>{o&&b.current&&b.current.focus()}),u.jsx("input",{type:"text",...a,className:"usa-combo-box__input","data-testid":"combo-box-input",autoCapitalize:"off",autoComplete:"off",ref:b})},ee=({id:o,name:a,className:b,options:p,defaultValue:I,disabled:h,onChange:s,assistiveHint:d,noResults:l,selectProps:m,inputProps:c,ulProps:M,customFilter:L,disableFiltering:R=!1},P)=>{var j;const y=!!h;let C;I&&(C=p.find(e=>e.value===I));const $=L||{filter:Z},V={isOpen:!1,selectedOption:C||void 0,focusedOption:void 0,focusMode:0,filteredOptions:p,inputValue:C?C.label:"",statusText:""},[t,r]=Y(V,p,R,$),g=f.useRef(null),_=f.useRef(null),E=f.useRef(null);f.useEffect(()=>{t.filteredOptions=p},[p]),f.useEffect(()=>{var e;s&&s(((e=t.selectedOption)==null?void 0:e.value)||void 0)},[t.selectedOption]),f.useEffect(()=>{t.focusMode===2&&t.focusedOption&&E.current&&E.current.focus()},[t.focusMode,t.focusedOption]),f.useEffect(()=>{if(t.isOpen&&t.focusedOption&&E.current&&_.current&&t.focusMode===1){const e=E.current.offsetTop+E.current.offsetHeight,i=_.current.scrollTop+_.current.offsetHeight;e>i&&(_.current.scrollTop=e-_.current.offsetHeight),E.current.offsetTop<_.current.scrollTop&&(_.current.scrollTop=E.current.offsetTop)}},[t.isOpen,t.focusedOption]),f.useEffect(()=>{var e;t.focusMode!==0&&((e=g.current)!=null&&e.contains(window.document.activeElement)||r({type:n.BLUR}))},[t.focusMode]),f.useImperativeHandle(P,()=>({focus:()=>r({type:n.FOCUS_INPUT}),clearSelection:()=>r({type:n.CLEAR_SELECTION})}),[]);const F=e=>{if(e.key==="Escape")r({type:n.CLOSE_LIST});else if(e.key==="ArrowDown"||e.key=="Down")e.preventDefault(),r({type:n.FOCUS_OPTION,option:t.selectedOption||t.focusedOption||t.filteredOptions[0]});else if(e.key==="Tab"){if(t.isOpen&&!t.selectedOption){const i=R?t.focusedOption:t.selectedOption||t.focusedOption;i?(e.preventDefault(),r({type:n.FOCUS_OPTION,option:i})):r({type:n.BLUR})}!t.isOpen&&t.selectedOption&&r({type:n.BLUR})}else if(e.key==="Enter"&&t.isOpen){e.preventDefault();const i=t.filteredOptions.find(O=>O.label.toLowerCase()===t.inputValue.toLowerCase());i?r({type:n.SELECT_OPTION,option:i}):t.selectedOption?r({type:n.CLOSE_LIST}):r({type:n.CLEAR})}},H=e=>{var T;const{relatedTarget:i}=e;(!i||i instanceof Node&&!((T=g.current)!=null&&T.contains(i)))&&t.focusMode!==0&&r({type:n.BLUR})},K=e=>{e.key==="Tab"&&t.isOpen&&t.selectedOption&&(e.preventDefault(),r({type:n.FOCUS_OPTION,option:t.selectedOption}))},v=(e,i,O)=>{const T=i.focusedOption?i.filteredOptions.indexOf(i.focusedOption):-1,S=i.filteredOptions[0],J=i.filteredOptions[i.filteredOptions.length-1];if(T===-1)e({type:n.FOCUS_OPTION,option:S});else{const w=T+O;if(w<0)e({type:n.CLOSE_LIST});else if(w>=i.filteredOptions.length)e({type:n.FOCUS_OPTION,option:J});else{const Q=i.filteredOptions[w];e({type:n.FOCUS_OPTION,option:Q})}}},q=e=>{var O;const{relatedTarget:i}=e;(!i||i instanceof Node&&!((O=g.current)!=null&&O.contains(i)))&&r({type:n.BLUR})},z=e=>{e.key==="Escape"?r({type:n.CLOSE_LIST}):e.key==="Tab"||e.key==="Enter"?(e.preventDefault(),t.focusedOption&&r({type:n.SELECT_OPTION,option:t.focusedOption})):e.key==="ArrowDown"||e.key==="Down"?(e.preventDefault(),v(r,t,1)):(e.key==="ArrowUp"||e.key==="Up")&&(e.preventDefault(),v(r,t,-1))},D=t.selectedOption&&t.selectedOption.label===t.inputValue,W=B("usa-combo-box",b,{"usa-combo-box--pristine":D}),N=`${o}--list`,U=`${o}--assistiveHint`,k=t.focusedOption?t.filteredOptions.findIndex(e=>e===t.focusedOption):-1,G=k>-1&&`${N}--option-${k}`;return u.jsxs("div",{"data-testid":"combo-box","data-enhanced":"true",className:W,ref:g,children:[u.jsx("select",{...m,className:"usa-select usa-sr-only usa-combo-box__select",name:a,"aria-hidden":!0,tabIndex:-1,defaultValue:(j=t.selectedOption)==null?void 0:j.value,"data-testid":"combo-box-select",children:p.map(e=>u.jsx("option",{value:e.value,children:e.label},e.value))}),u.jsx(A,{...c,role:"combobox",onChange:e=>{c!=null&&c.onChange&&(c==null||c.onChange(e)),r({type:n.UPDATE_FILTER,value:e.target.value})},onClick:()=>r({type:n.OPEN_LIST}),onBlur:H,onKeyDown:F,value:t.inputValue,focused:t.focusMode===1,"aria-owns":N,"aria-controls":N,"aria-autocomplete":"list","aria-describedby":U,"aria-expanded":t.isOpen,"aria-activedescendant":t.isOpen&&G||"",id:o,disabled:y}),u.jsx("span",{className:"usa-combo-box__clear-input__wrapper",tabIndex:-1,children:u.jsx("button",{type:"button",className:"usa-combo-box__clear-input","aria-label":"Clear the select contents",onClick:()=>r({type:n.CLEAR}),"data-testid":"combo-box-clear-button",onKeyDown:K,hidden:!D||y,disabled:y,children:" "})}),u.jsx("span",{className:"usa-combo-box__input-button-separator",children:" "}),u.jsx("span",{className:"usa-combo-box__toggle-list__wrapper",tabIndex:-1,children:u.jsx("button",{"data-testid":"combo-box-toggle",type:"button",className:"usa-combo-box__toggle-list",tabIndex:-1,"aria-label":"Toggle the dropdown list",onClick:()=>r({type:t.isOpen?n.CLOSE_LIST:n.OPEN_LIST}),disabled:y,children:" "})}),u.jsxs("ul",{...M,"data-testid":"combo-box-option-list",tabIndex:-1,id:N,className:"usa-combo-box__list",role:"listbox",ref:_,hidden:!t.isOpen,children:[t.filteredOptions.map((e,i)=>{const O=e===t.focusedOption,T=e===t.selectedOption,S=B("usa-combo-box__list-option",{"usa-combo-box__list-option--focused":O,"usa-combo-box__list-option--selected":T});return u.jsx("li",{ref:O?E:null,value:e.value,className:S,tabIndex:O?0:-1,role:"option","aria-selected":T,"aria-setsize":t.filteredOptions.length,"aria-posinset":i+1,id:N+`--option-${i}`,onKeyDown:z,onBlur:q,"data-testid":`combo-box-option-${e.value}`,"data-value":e.value,onMouseEnter:()=>r({type:n.FOCUS_OPTION,option:e}),onClick:()=>{r({type:n.SELECT_OPTION,option:e})},children:e.label},e.value)}),t.filteredOptions.length===0?u.jsx("li",{className:"usa-combo-box__list-option--no-results",children:l||"No results found"}):null]}),u.jsx("div",{className:"usa-combo-box__status usa-sr-only",role:"status",children:t.statusText}),u.jsx("span",{id:U,className:"usa-sr-only","data-testid":"combo-box-assistive-hint",children:d||`When autocomplete results are available use up and down arrows to review
           and enter to select. Touch device users, explore by touch or with swipe
           gestures.`})]})},te=f.forwardRef(ee);te.__docgenInfo={description:"",methods:[{name:"focus",docblock:null,modifiers:[],params:[],returns:{type:{name:"void"}}},{name:"clearSelection",docblock:null,modifiers:[],params:[],returns:{type:{name:"void"}}}],displayName:"ComboBox",props:{disableFiltering:{defaultValue:{value:"false",computed:!1},required:!1}}};export{te as C};
